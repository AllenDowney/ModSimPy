

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Cooling Coffee &#8212; Modeling and Simulation in Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap15';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding Milk" href="chap16.html" />
    <link rel="prev" title="Nondimensionalization" href="chap14.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">Modeling and Simulation in Python</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Modeling and Simulation in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Bike Share System</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Sweeping Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">World Population</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Proportional Growth</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Limits to Growth</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Projecting Population Growth</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Analysis of Population Growth</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Case Studies Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Epidemiology</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Modeling Vaccination</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Sweeping Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Nondimensionalization</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Cooling Coffee</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap16.html">Adding Milk</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Pharmacokinetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Glucose and Insulin</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap19.html">Case Studies Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap20.html">The Empire State Building Strikes Back</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap21.html">Drag</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap22.html">Baseball</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap23.html">Optimal Baseball</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap24.html">Rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap25.html">Torque</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap26.html">Case Studies Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap27.html">Under the Hood</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="queue.html">One Queue or Two</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ModSimPy" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap15.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cooling Coffee</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-coffee-cooling-problem">The Coffee Cooling Problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-and-heat">Temperature and Heat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-transfer">Heat Transfer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#newton-s-law-of-cooling">Newton’s Law of Cooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-newtonian-cooling">Implementing Newtonian Cooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-roots">Finding Roots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-r">Estimating r</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cooling-coffee">
<h1>Cooling Coffee<a class="headerlink" href="#cooling-coffee" title="Permalink to this heading">#</a></h1>
<p>This chapter is available as a Jupyter notebook where you can read the text, run the code, and work on the exercises.
Click here to access the notebooks: <a class="reference external" href="https://allendowney.github.io/ModSimPy/">https://allendowney.github.io/ModSimPy/</a>.</p>
<p>So far the systems we have studied have been physical in the sense that they exist in the world, but they have not been physics in the sense of what physics classes are usually about. In the next few chapters, we’ll do some physics, starting with <em>thermal systems</em>, that is, systems where the temperature of objects changes as heat transfers from one to another.</p>
<section id="the-coffee-cooling-problem">
<h2>The Coffee Cooling Problem<a class="headerlink" href="#the-coffee-cooling-problem" title="Permalink to this heading">#</a></h2>
<p>The coffee cooling problem was discussed by Jearl Walker in
“The Amateur Scientist”, <em>Scientific American</em>, Volume 237, Issue 5, November 1977. Since then it has become a standard example of modeling and simulation.</p>
<p>Here is my version of the problem:</p>
<blockquote>
<div><p>Suppose I stop on the way to work to pick up a cup of coffee and a small container of milk. Assuming that I want the coffee to be as hot as possible when I arrive at work, should I add the milk at the coffee shop, wait until I get to work, or add the milk at some point in between?</p>
</div></blockquote>
<p>To help answer this question, I made a trial run with the milk and
coffee in separate containers and took some measurements (not really):</p>
<ul class="simple">
<li><p>When served, the temperature of the coffee is 90 °C. The volume is
300 mL.</p></li>
<li><p>The milk is at an initial temperature of 5 °C, and I take about
50 mL.</p></li>
<li><p>The ambient temperature in my car is 22 °C.</p></li>
<li><p>The coffee is served in a well insulated cup. When I arrive at work after 30 minutes, the temperature of the coffee has fallen to 70 °C.</p></li>
<li><p>The milk container is not as well insulated. After 15 minutes, it
warms up to 20 °C, nearly the ambient temperature.</p></li>
</ul>
<p>To use this data and answer the question, we have to know something
about temperature and heat, and we have to make some modeling decisions.</p>
</section>
<section id="temperature-and-heat">
<h2>Temperature and Heat<a class="headerlink" href="#temperature-and-heat" title="Permalink to this heading">#</a></h2>
<p>To understand how coffee cools (and milk warms), we need a model of
temperature and heat. <em>Temperature</em> is a property of an object or a
system; in SI units it is measured in degrees Celsius (°C). Temperature quantifies how hot or cold the object is, which is related to the average velocity of the particles that make it up.</p>
<p>When particles in a hot object contact particles in a cold object, the
hot object gets cooler and the cold object gets warmer as energy is
transferred from one to the other. The transferred energy is called
<em>heat</em>; in SI units it is measured in joules (J).</p>
<p>Heat is related to temperature by the following equation (see
<a class="reference external" href="http://modsimpy.com/thermass">http://modsimpy.com/thermass</a>):</p>
<div class="math notranslate nohighlight">
\[Q = C~\Delta T\]</div>
<p>where <span class="math notranslate nohighlight">\(Q\)</span> is the amount of heat transferred to an object, <span class="math notranslate nohighlight">\(\Delta T\)</span> is the resulting change in temperature, and <span class="math notranslate nohighlight">\(C\)</span> is the object’s <em>thermal mass</em>, which is a property of the object that determines how much energy it takes to heat or cool it. In SI units, thermal mass is measured in joules per degree Celsius (J/°C).</p>
<p>For objects made primarily from one material, thermal mass can be
computed like this:</p>
<div class="math notranslate nohighlight">
\[C = m c_p\]</div>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the mass of the object and <span class="math notranslate nohighlight">\(c_p\)</span> is the <em>specific heat capacity</em> of the material, which is the amount of thermal mass per gram (see <a class="reference external" href="http://modsimpy.com/specheat">http://modsimpy.com/specheat</a>).</p>
<p>We can use these equations to estimate the thermal mass of a cup of
coffee. The specific heat capacity of coffee is probably close to that
of water, which is 4.2 J/g/°C. Assuming that the density of coffee is
close to that of water, which is 1 g/mL, the mass of 300 mL of coffee is 300 g, and the thermal mass is 1260 J/°C.</p>
<p>So when a cup of coffee cools from 90 °C to 70 °C, the change in
temperature, <span class="math notranslate nohighlight">\(\Delta T\)</span> is 20 °C, which means that 25 200 J of heat
energy was transferred from the cup and the coffee to the surrounding environment
(the cup holder and air in my car).</p>
<p>To give you a sense of how much energy that is, if you were able to
harness all of that heat to do work (which you cannot), you could
use it to lift a cup of coffee from sea level to 8571 m, just shy of the height of Mount Everest, 8848 m.</p>
</section>
<section id="heat-transfer">
<h2>Heat Transfer<a class="headerlink" href="#heat-transfer" title="Permalink to this heading">#</a></h2>
<p>In a situation like the coffee cooling problem, there are three ways
heat transfers from one object to another (see <a class="reference external" href="http://modsimpy.com/transfer">http://modsimpy.com/transfer</a>):</p>
<ul class="simple">
<li><p>Conduction: When objects at different temperatures come into
contact, the faster-moving particles of the higher-temperature
object transfer kinetic energy to the slower-moving particles of the lower-temperature object.</p></li>
<li><p>Convection: When particles in a gas or liquid flow from place to
place, they carry heat energy with them. Fluid flows can be caused
by external action, like stirring, or by internal differences in
temperature. For example, you might have heard that hot air rises,
which is a form of “natural convection”.</p></li>
<li><p>Radiation: As the particles in an object move due to thermal energy,
they emit electromagnetic radiation. The energy carried by this
radiation depends on the object’s temperature and surface properties
(see <a class="reference external" href="http://modsimpy.com/thermrad">http://modsimpy.com/thermrad</a>).</p></li>
</ul>
<p>For objects like coffee in a car, the effect of radiation is much
smaller than the effects of conduction and convection, so we will ignore it.</p>
<p>Convection can be a complex topic, since it often depends on details of fluid flow in three dimensions. But for this problem we will be able to get away with a simple model called “Newton’s law of cooling”.</p>
</section>
<section id="newton-s-law-of-cooling">
<h2>Newton’s Law of Cooling<a class="headerlink" href="#newton-s-law-of-cooling" title="Permalink to this heading">#</a></h2>
<p><em>Newton’s law of cooling</em> asserts that the temperature rate of change for an object is proportional to the difference in temperature between the object and the surrounding environment:</p>
<div class="math notranslate nohighlight">
\[\frac{dT}{dt} = -r (T - T_{env})\]</div>
<p>where <span class="math notranslate nohighlight">\(t\)</span> is time, <span class="math notranslate nohighlight">\(T\)</span> is the temperature of the object, <span class="math notranslate nohighlight">\(T_{env}\)</span> is the temperature of the environment, and <span class="math notranslate nohighlight">\(r\)</span> is a constant that characterizes how quickly heat is transferred between the object and the environment.</p>
<p>Newton’s so-called “law ” is really a model: it is a good approximation in some conditions and less good in others.</p>
<p>For example, if the primary mechanism of heat transfer is conduction,
Newton’s law is “true”, which is to say that <span class="math notranslate nohighlight">\(r\)</span> is constant over a
wide range of temperatures. And sometimes we can estimate <span class="math notranslate nohighlight">\(r\)</span> based on
the material properties and shape of the object.</p>
<p>When convection contributes a non-negligible fraction of heat transfer, <span class="math notranslate nohighlight">\(r\)</span> depends on temperature, but Newton’s law is often accurate enough, at least over a narrow range of temperatures. In this case <span class="math notranslate nohighlight">\(r\)</span> usually has to be estimated experimentally, since it depends on details of surface shape, air flow, evaporation, etc.</p>
<p>When radiation makes up a substantial part of heat transfer, Newton’s
law is not a good model at all. This is the case for objects in space or in a vacuum, and for objects at high temperatures (more than a few
hundred degrees Celsius, say).</p>
<p>However, for a situation like the coffee cooling problem, we expect Newton’s model to be quite good.</p>
<p>With that, we have just one more modeling decision to make: whether to treat the coffee and the cup as separate objects or a single object. If the cup is made of paper, it has less mass than the coffee, and the specific heat capacity of paper is lower, too. In that case, it would be reasonable to treat the cup and coffee as a single object. For a cup with substantial thermal mass, like a ceramic mug, we might consider a model that computes the temperature of coffee and cup separately.</p>
</section>
<section id="implementing-newtonian-cooling">
<h2>Implementing Newtonian Cooling<a class="headerlink" href="#implementing-newtonian-cooling" title="Permalink to this heading">#</a></h2>
<p>To get started, we’ll focus on the coffee. Then, as an exercise, you can simulate the milk. In the next chapter, we’ll put them together, literally.</p>
<p>Here’s a function that takes the parameters of the system and makes a <code class="docutils literal notranslate"><span class="pre">System</span></code> object:</p>
<div class="cell tag_export docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_system</span><span class="p">(</span><span class="n">T_init</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t_end</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">System</span><span class="p">(</span><span class="n">T_init</span><span class="o">=</span><span class="n">T_init</span><span class="p">,</span>
                  <span class="n">T_final</span><span class="o">=</span><span class="n">T_init</span><span class="p">,</span>
                  <span class="n">volume</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span>
                  <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
                  <span class="n">t_end</span><span class="o">=</span><span class="n">t_end</span><span class="p">,</span>
                  <span class="n">T_env</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span>
                  <span class="n">t_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In addition to the parameters, <code class="docutils literal notranslate"><span class="pre">make_system</span></code> sets the temperature of the environment, <code class="docutils literal notranslate"><span class="pre">T_env</span></code>, the initial time stamp, <code class="docutils literal notranslate"><span class="pre">t_0</span></code>, and the time step, <code class="docutils literal notranslate"><span class="pre">dt</span></code>, which we will use to simulate the cooling process.
Here’s a <code class="docutils literal notranslate"><span class="pre">System</span></code> object that represents the coffee.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coffee</span> <span class="o">=</span> <span class="n">make_system</span><span class="p">(</span><span class="n">T_init</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The values of <code class="docutils literal notranslate"><span class="pre">T_init</span></code>, <code class="docutils literal notranslate"><span class="pre">volume</span></code>, and <code class="docutils literal notranslate"><span class="pre">t_end</span></code> come from the statement of the problem.
I chose the value of <code class="docutils literal notranslate"><span class="pre">r</span></code> arbitrarily for now; we will see how to estimate it soon.</p>
<p>Strictly speaking, Newton’s law is a differential equation, but over a short period of time we can approximate it with a difference equation:</p>
<div class="math notranslate nohighlight">
\[\Delta T = -r (T - T_{env}) dt\]</div>
<p>where <span class="math notranslate nohighlight">\(dt\)</span> is the time step and <span class="math notranslate nohighlight">\(\Delta T\)</span> is the change in temperature during that time step.</p>
<p>Note: I use <span class="math notranslate nohighlight">\(\Delta T\)</span> to denote a change in temperature over time, but in the context of heat transfer, you might also see <span class="math notranslate nohighlight">\(\Delta T\)</span> used to denote the difference in temperature between an object and its
environment, <span class="math notranslate nohighlight">\(T - T_{env}\)</span>. To minimize confusion, I avoid this second
use.</p>
<p>The following function takes the current time <code class="docutils literal notranslate"><span class="pre">t</span></code>, the current temperature, <code class="docutils literal notranslate"><span class="pre">T</span></code>, and a <code class="docutils literal notranslate"><span class="pre">System</span></code> object, and computes the change in temperature during a time step:</p>
<div class="cell tag_export docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">change_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">T_env</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">T_env</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">dt</span>    
    <span class="k">return</span> <span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">T_env</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
</pre></div>
</div>
</div>
</div>
<p>We can test it with the initial temperature of the coffee, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">change_func</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">coffee</span><span class="o">.</span><span class="n">T_init</span><span class="p">,</span> <span class="n">coffee</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.68
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">dt=1</span></code> minute, the temperature drops by about 0.7 °C, at least for this value of <code class="docutils literal notranslate"><span class="pre">r</span></code>.</p>
<p>Now here’s a version of <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code> that simulates a series of time steps from <code class="docutils literal notranslate"><span class="pre">t_0</span></code> to <code class="docutils literal notranslate"><span class="pre">t_end</span></code>:</p>
<div class="cell tag_export docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">change_func</span><span class="p">):</span>
    <span class="n">t_array</span> <span class="o">=</span> <span class="n">linrange</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">t_0</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">t_end</span><span class="p">,</span> <span class="n">system</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_array</span><span class="p">)</span>
    
    <span class="n">series</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">t_array</span><span class="p">)</span>
    <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">T_init</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t_array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">change_func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
    
    <span class="n">system</span><span class="o">.</span><span class="n">T_final</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">series</span>
</pre></div>
</div>
</div>
</div>
<p>There are two things here that are different from previous versions of <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code>.</p>
<p>First, we use  <code class="docutils literal notranslate"><span class="pre">linrange</span></code> to make an array of values from <code class="docutils literal notranslate"><span class="pre">t_0</span></code> to <code class="docutils literal notranslate"><span class="pre">t_end</span></code> with time step <code class="docutils literal notranslate"><span class="pre">dt</span></code>.
<code class="docutils literal notranslate"><span class="pre">linrange</span></code> is similar to <code class="docutils literal notranslate"><span class="pre">linspace</span></code>; they both take a start value and an end value and return an array of equally spaced values.
The difference is the third argument: <code class="docutils literal notranslate"><span class="pre">linspace</span></code> takes an integer that indicates the number of points in the range; <code class="docutils literal notranslate"><span class="pre">linrange</span></code> takes a step size that indicates the interval between values.
When we make the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>, we use the keyword argument <code class="docutils literal notranslate"><span class="pre">index</span></code> to indicate that the index of the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> is the array of time stamps, <code class="docutils literal notranslate"><span class="pre">t_array</span></code>.</p>
<p>Second, this version of <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code> uses <code class="docutils literal notranslate"><span class="pre">iloc</span></code> rather than <code class="docutils literal notranslate"><span class="pre">loc</span></code> to specify the rows in the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>.
Here’s the difference:</p>
<ul class="simple">
<li><p>With <code class="docutils literal notranslate"><span class="pre">loc</span></code>, the label in brackets can be any kind of value, with any start, end, and time step.  For example, in the world population model, the labels are years starting in 1960 and ending in 2016.</p></li>
<li><p>With <code class="docutils literal notranslate"><span class="pre">iloc</span></code>, the label in brackets is always an integer starting at 0.  So we can always get the first element with <code class="docutils literal notranslate"><span class="pre">iloc[0]</span></code> and the last element with <code class="docutils literal notranslate"><span class="pre">iloc[-1]</span></code>, regardless of what the labels are.</p></li>
</ul>
<p>In this version of <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code>, the loop variable is an integer, <code class="docutils literal notranslate"><span class="pre">i</span></code>, that goes from <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">n-1</span></code>, including <code class="docutils literal notranslate"><span class="pre">0</span></code> but not including <code class="docutils literal notranslate"><span class="pre">n-1</span></code>.
So the first time through the loop, <code class="docutils literal notranslate"><span class="pre">i</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> and the value we add to the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> has index 1.
The last time through the loop, <code class="docutils literal notranslate"><span class="pre">i</span></code> is <code class="docutils literal notranslate"><span class="pre">n-2</span></code> and the value we add has index <code class="docutils literal notranslate"><span class="pre">n-1</span></code>.</p>
<p>We can run the simulation like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="n">coffee</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is a <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> with one row per time step.
Here are the first few rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Quantity</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>90.000000</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>89.320000</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>88.646800</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>87.980332</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>87.320529</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And the last few rows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Quantity</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26.0</th>
      <td>74.362934</td>
    </tr>
    <tr>
      <th>27.0</th>
      <td>73.839305</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>73.320912</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>72.807702</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>72.299625</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">t_0=0</span></code>, <code class="docutils literal notranslate"><span class="pre">t_end=30</span></code>, and <code class="docutils literal notranslate"><span class="pre">dt=1</span></code>, the time stamps go from <code class="docutils literal notranslate"><span class="pre">0.0</span></code> to <code class="docutils literal notranslate"><span class="pre">30.0</span></code>.</p>
<p>Here’s what the <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;coffee&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (min)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Coffee Cooling&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/71f824fe8df44e3a145492aa879121ae3c730de336d50a6bed515912c44b34e7.png" src="_images/71f824fe8df44e3a145492aa879121ae3c730de336d50a6bed515912c44b34e7.png" />
</div>
</div>
<p>The temperature after 30 minutes is 72.3 °C, which is a little higher than the measurement we’re trying to match, which is 70 °C.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coffee</span><span class="o">.</span><span class="n">T_final</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>72.2996253904031
</pre></div>
</div>
</div>
</div>
<p>To find the value of <code class="docutils literal notranslate"><span class="pre">r</span></code> where the final temperature is precisely 70 °C, we could proceed by trial and error, but it is more efficient to use a root-finding algorithm.</p>
</section>
<section id="finding-roots">
<h2>Finding Roots<a class="headerlink" href="#finding-roots" title="Permalink to this heading">#</a></h2>
<p>The ModSim library provides a function called <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> that finds the roots of non-linear equations. As an example, suppose you want to find the roots of the polynomial</p>
<div class="math notranslate nohighlight">
\[f(x) = (x - 1)(x - 2)(x - 3)\]</div>
<p>A <em>root</em> is a value of <span class="math notranslate nohighlight">\(x\)</span> that makes <span class="math notranslate nohighlight">\(f(x)=0\)</span>. Because of the way I wrote this polynomial, we can see that if <span class="math notranslate nohighlight">\(x=1\)</span>, the first factor is 0; if <span class="math notranslate nohighlight">\(x=2\)</span>, the second factor is 0; and if <span class="math notranslate nohighlight">\(x=3\)</span>, the third factor is 0, so those are the roots.</p>
<p>I’ll use this example to demonstrate <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code>. First, we have to
write a function that evaluates <span class="math notranslate nohighlight">\(f\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we call <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      converged: True
           flag: &#39;converged&#39;
 function_calls: 3
     iterations: 2
           root: 2.0
</pre></div>
</div>
</div>
</div>
<p>The first argument is the function whose roots we want. The second
argument is an interval that contains or <em>brackets</em> a root. The result is an object that contains several variables, including the Boolean value <code class="docutils literal notranslate"><span class="pre">converged</span></code>, which is <code class="docutils literal notranslate"><span class="pre">True</span></code> if the  search converged successfully on a root, and <code class="docutils literal notranslate"><span class="pre">root</span></code>, which is the root that was found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0
</pre></div>
</div>
</div>
</div>
<p>If we provide a different interval, we find a different root.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">])</span>
<span class="n">res</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.9999771663211003
</pre></div>
</div>
</div>
</div>
<p>If the interval doesn’t contain a root, you’ll get a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> and a message like <code class="docutils literal notranslate"><span class="pre">f(a)</span> <span class="pre">and</span> <span class="pre">f(b)</span> <span class="pre">must</span> <span class="pre">have</span> <span class="pre">different</span> <span class="pre">signs</span></code>.</p>
<p>Now we can use <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> to estimate <code class="docutils literal notranslate"><span class="pre">r</span></code>.</p>
</section>
<section id="estimating-r">
<h2>Estimating r<a class="headerlink" href="#estimating-r" title="Permalink to this heading">#</a></h2>
<p>What we want is the value of <code class="docutils literal notranslate"><span class="pre">r</span></code> that yields a final temperature of
70 °C. To use <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code>, we need a function that takes <code class="docutils literal notranslate"><span class="pre">r</span></code> as a parameter and returns the difference between the final temperature and the goal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error_func</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
    <span class="n">system</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span><span class="o">.</span><span class="n">T_final</span> <span class="o">-</span> <span class="mi">70</span>
</pre></div>
</div>
</div>
</div>
<p>This is called an <em>error function</em> because it returns the
difference between what we got and what we wanted, that is, the error.
With the right value of <code class="docutils literal notranslate"><span class="pre">r</span></code>, the error is 0.</p>
<p>We can test <code class="docutils literal notranslate"><span class="pre">error_func</span></code> like this, using the initial guess <code class="docutils literal notranslate"><span class="pre">r=0.01</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coffee</span> <span class="o">=</span> <span class="n">make_system</span><span class="p">(</span><span class="n">T_init</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">error_func</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">coffee</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.2996253904030937
</pre></div>
</div>
</div>
</div>
<p>The result is an error of 2.3 °C, which means the final temperature with <code class="docutils literal notranslate"><span class="pre">r=0.01</span></code> is too high.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">error_func</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">coffee</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-10.907066281994297
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">r=0.02</span></code>, the error is  about -11°C, which means that the final temperature is too low. So we know that the correct value must be in between.</p>
<p>Now we can call <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">error_func</span><span class="p">,</span> <span class="n">coffee</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>
<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      converged: True
           flag: &#39;converged&#39;
 function_calls: 6
     iterations: 5
           root: 0.011543084190599507
</pre></div>
</div>
</div>
</div>
<p>The first argument is the error function.
The second argument is the <code class="docutils literal notranslate"><span class="pre">System</span></code> object, which <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> passes as an argument to <code class="docutils literal notranslate"><span class="pre">error_func</span></code>.
The third argument is an interval that brackets the root.</p>
<p>Here’s the root we found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_coffee</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
<span class="n">r_coffee</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.011543084190599507
</pre></div>
</div>
</div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">r_coffee</span></code> turns out to be about <code class="docutils literal notranslate"><span class="pre">0.0115</span></code>, in units of min<span class="math notranslate nohighlight">\(^{-1}\)</span> (inverse minutes).
We can confirm that this value is correct by setting <code class="docutils literal notranslate"><span class="pre">r</span></code> to the root we found and running the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coffee</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
<span class="n">run_simulation</span><span class="p">(</span><span class="n">coffee</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
<span class="n">coffee</span><span class="o">.</span><span class="n">T_final</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>70.00000057308064
</pre></div>
</div>
</div>
</div>
<p>The final temperature is very close to 70 °C.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>This chapter presents the basics of heat, temperature, and Newton’s law of cooling, which is a model that is accurate when most heat transfer is by conduction and convection, not radiation.</p>
<p>To simulate a hot cup of coffee, we wrote Newton’s law as a difference equation, then wrote a version of <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code> that implements it. Then we used <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> to find the value of <code class="docutils literal notranslate"><span class="pre">r</span></code> that matches the measurement from my hypothetical experiment.</p>
<p>All that is the first step toward solving the coffee cooling problem I posed at the beginning of the chapter. As an exercise, you’ll do the next step, which is simulating the milk. In the next chapter, we’ll model the mixing process and finish off the problem.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p>This chapter is available as a Jupyter notebook where you can read the text, run the code, and work on the exercises.
You can access the notebooks at <a class="reference external" href="https://allendowney.github.io/ModSimPy/">https://allendowney.github.io/ModSimPy/</a>.</p>
<section id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this heading">#</a></h3>
<p>Simulate the temperature of 50 mL of milk with a starting temperature of 5 °C, in a vessel with <code class="docutils literal notranslate"><span class="pre">r=0.1</span></code>, for 15 minutes, and plot the results. Use <code class="docutils literal notranslate"><span class="pre">make_system</span></code> to make a <code class="docutils literal notranslate"><span class="pre">System</span></code> object that represents the milk, and use <code class="docutils literal notranslate"><span class="pre">run_simulation</span></code> to simulate it.
By trial and error, find a value for <code class="docutils literal notranslate"><span class="pre">r</span></code> that makes the final temperature close to 20 °C.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">milk</span> <span class="o">=</span> <span class="n">make_system</span><span class="p">(</span><span class="n">T_init</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">t_end</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">results_milk</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="n">milk</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
<span class="n">milk</span><span class="o">.</span><span class="n">T_final</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18.499850754390966
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">results_milk</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;milk&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Time (min)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/518f9ad3d8dd4a7ba7ebc3618a604f72f17cdb2b73875c1bb2964d340b034686.png" src="_images/518f9ad3d8dd4a7ba7ebc3618a604f72f17cdb2b73875c1bb2964d340b034686.png" />
</div>
</details>
</div>
</section>
<section id="exercise-2">
<h3>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this heading">#</a></h3>
<p>Write an error function that simulates the temperature of the milk and returns the difference between the final temperature and 20 °C.  Use it to estimate the value of <code class="docutils literal notranslate"><span class="pre">r</span></code> for the milk.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="k">def</span> <span class="nf">error_func2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
    <span class="n">system</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span><span class="o">.</span><span class="n">T_final</span> <span class="o">-</span> <span class="mi">20</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">root_scalar</span><span class="p">(</span><span class="n">error_func2</span><span class="p">,</span> <span class="n">milk</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="n">res</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      converged: True
           flag: &#39;converged&#39;
 function_calls: 6
     iterations: 5
           root: 0.011543084190599507
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">run_simulation</span><span class="p">(</span><span class="n">milk</span><span class="p">,</span> <span class="n">change_func</span><span class="p">)</span>
<span class="n">milk</span><span class="o">.</span><span class="n">T_final</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20.000229743777304
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap14.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Nondimensionalization</p>
      </div>
    </a>
    <a class="right-next"
       href="chap16.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Adding Milk</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-coffee-cooling-problem">The Coffee Cooling Problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#temperature-and-heat">Temperature and Heat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-transfer">Heat Transfer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#newton-s-law-of-cooling">Newton’s Law of Cooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-newtonian-cooling">Implementing Newtonian Cooling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-roots">Finding Roots</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-r">Estimating r</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1">Exercise 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2">Exercise 2</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>